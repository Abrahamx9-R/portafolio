---
import { getCollection } from "astro:content";
import SectionContainer from "./SectionContainer.astro";
import ProjectCard from "./ProjectCard.astro";
import { t } from "../i18n/translations";
import type { Lang } from "../i18n/translations";
import { getLocalizedPath } from "../i18n/utils";

interface Props {
    lang?: Lang;
}

const { lang = "es" } = Astro.props;

// Fetch all blog posts that are marked as projects and match current lang
const projects = (await getCollection("blog"))
    .filter((post) => post.data.isProject && post.data.lang === lang)
    .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());
---

<SectionContainer id="projects">
    <div class="flex items-end justify-between mb-12">
        <h2
            class="text-4xl md:text-5xl font-heading font-bold text-transparent bg-clip-text bg-gradient-to-r from-white to-gray-500"
        >
            {t(lang, "projects.title.1")}
            <span class="text-neon-cyan">{t(lang, "projects.title.2")}</span>
        </h2>
        <div
            class="hidden md:block h-[1px] flex-1 bg-gradient-to-r from-neon-cyan/50 to-transparent mx-8 mb-4"
        >
        </div>
        <span class="hidden md:block font-mono text-neon-cyan/50"
            >{t(lang, "projects.section")}</span
        >
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {
            projects.length > 0 ? (
                projects.map((project) => (
                    <ProjectCard
                        title={project.data.title}
                        description={project.data.description}
                        tags={project.data.tags || []}
                        image={project.data.heroImage}
                        link={getLocalizedPath(
                            `/blog/${project.slug.split("/").pop()}`,
                            lang,
                        )}
                    />
                ))
            ) : (
                <div class="col-span-3 p-12 border border-white/10 bg-space-800/20 text-center">
                    <p class="text-gray-400 font-mono">
                        {t(lang, "projects.empty")}
                    </p>
                </div>
            )
        }
    </div>
</SectionContainer>
